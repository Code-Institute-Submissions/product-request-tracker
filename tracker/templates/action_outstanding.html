{% extends 'base.html' %} {% block title %}
<title>Request Tracker | Actions</title>{% endblock %} {% block content %}


<div class="container-fluid">
    <div class="row">
        <div class="col s12">
            <h4 class="branded-title">Actions</h4>
        </div>
    </div>
</div>

{% if current_user.user_type in (1,2,3,4) %}

<!-- Action Users -->

<div class="container">
    <div class="row">
        {% for action in actions %}
        <a href="{{ url_for('action.action_answer', action_id=action.id) }}">
            <div class="col s12 l6 branded-blue text-white zoom action-cards">
                {% if action.stage == 1 %}
                <h4>Health & Safety</h4>
                {% elif action.stage == 2 %}
                <h4>Quality</h4>
                {% elif action.stage == 3 %}
                <h4>Cagefill</h4>
                {% else %}
                <h4>Restaurant Impact</h4>
                {% endif %} 

                <h5>{{ action.action_post.product_number }} - {{ action.action_post.product_name }}</h5>
                <p>{{ action.action_post.supplier.supplier_name }}</p>
                <p>{{ action.created_on.strftime('%d/%m/%Y') }}</p>

                {% if action.approval == 1 %}
                <h6 class="red-text">Rejected</h6>
                {% elif action.approval == 2 %}
                <h6 class="yellow-text">Further information</h6>
                {% elif action.approval == 3 %}
                <h6 class="green-text">Approved</h6>
                {% else %}
                <h6>Action Pending</h6>
                {% endif %}

            </div>
        </a>
        {% endfor %}
    </div>
</div>

<!--Tracker Users -->

{% else %}

<div class="container">
    <div class="row">
        {% for action in actions %} {% if action.approval == None %}
        <a href="{{ url_for('action.action_edit', action_id=action.id) }}">
            <div class="col s12 l6 action-cards branded-blue text-white zoom">
                {% if action.stage == 1 %}
                <h4>Health & Safety</h4>
                {% elif action.stage == 2 %}
                <h4>Quality</h4>
                {% elif action.stage == 3 %}
                <h4>Cagefill</h4>
                {% else %}
                <h4>Restaurant Impact</h4>
                {% endif %} 

                <h5>{{ action.action_post.product_number }} - {{ action.action_post.product_name }}</h5>
                <p>{{ action.action_post.supplier.supplier_name }}</p>
                <p>{{ action.created_on.strftime('%d/%m/%Y') }}</p>

                {% if action.approval == 1 %}
                <h6 class="red-text">Rejected</h6>
                {% elif action.approval == 2 %}
                <h6 class="yellow-text">Further information</h6>
                {% elif action.approval == 3 %}
                <h6 class="green-text">Approved</h6>
                {% else %}
                <h6>Action Pending</h6>
                {% endif %}

            </div>
        </a>
        {% else %}
        <a class="modal-trigger action-toggle" href="#modal{{ action.id }}">
            <div class="col s12 l6 action-cards branded-blue text-white zoom">
                {% if action.stage == 1 %}
                <h4>Health & Safety</h4>
                {% elif action.stage == 2 %}
                <h4>Quality</h4>
                {% elif action.stage == 3 %}
                <h4>Cagefill</h4>
                {% else %}
                <h4>Restaurant Impact</h4>
                {% endif %} 

                <h5>{{ action.action_post.product_number }} - {{ action.action_post.product_name }}</h5>
                <p>{{ action.action_post.supplier.supplier_name }}</p>
                <p>{{ action.created_on.strftime('%d/%m/%Y') }}</p>

                {% if action.approval == 1 %}
                <h6 class="red-text">Rejected</h6>
                {% elif action.approval == 2 %}
                <h6 class="yellow-text">Further information</h6>
                {% elif action.approval == 3 %}
                <h6 class="green-text">Approved</h6>
                {% else %}
                <h6>Action Pending</h6>
                {% endif %}

            </div>
        </a>
        <div id="modal{{ action.id }}" class="modal">
            <div class="modal-content">
                <h4>Feedback</h4>
                <p>{{ action.feedback }}</p>
                {% if action.stage != 1 %}
                <table class="centered branded-product-table">
                    <thead class="text-white">
                        <tr>
                            <th>Description</th>
                            <th>Current</th>
                            <th>Proposed</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Cases per Layer</td>
                            <td>{{ action.ex_case_per_layer }}</td>
                            <td>{{ action.case_per_layer }}</td>
                        </tr>
                        <tr>
                            <td>Layers Per Stack</td>
                            <td>{{ action.ex_total_layers }}</td>
                            <td>{{ action.total_layers }}</td>
                        </tr>
                        <tr>
                            <td>Total Cases</td>
                            <td>{{ action.ex_total_cases }}</td>
                            <td>{{ action.total_cases }}</td>
                        </tr>
                        <tr>
                            <td>Total Units</td>
                            <td class="numberFormat">{{ action.ex_total_cases * action.action_post.ex_units_per_case }}</td>
                            <td class="numberFormat">{{ action.total_cases * action.action_post.units_per_case }}</td>
                        </tr>
                    </tbody>
                </table>
                {% endif %}
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-green btn-flat">OK</a>
            </div>
        </div>
        {% endif %} {% endfor %}
    </div>
</div>
{% endif %}

<!--Toggle Actions 'Complete' status on/off Button-->

<div class="fixed-action-btn">
    <a id="action-toggle" class="btn-floating btn-large tooltipped" data-position="left" data-tooltip="Toggle Complete Actions" href="#">
        <i class="material-icons left">filter_list</i>
    </a>
</div>

{% endblock content %}{% block script %}

<script type="text/javascript">
    $(document).ready(function() {

        $("#action-toggle").click(function() {
            $(".action-toggle").toggle()
        });
    });
</script>

{% endblock script %}
